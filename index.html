<!DOCTYPE html>
<html lang="en">
<head>
    <!-- =================================================== -->
    <!-- ============== SEO ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶ü‡¶æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó ‡¶∂‡ßÅ‡¶∞‡ßÅ ============== -->
    <!-- =================================================== -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google Site Verification -->
    <meta name="google-site-verification" content="1mDUrmtjTiKfrYayJONYnzIhgBQcw30UZi0Q1hdhAO4" />

    <!-- Primary Meta Tags -->
    <title>Movie TV - Watch & Download Latest HD Movies</title>
    <meta name="title" content="Movie TV - Watch & Download Latest HD Movies">
    <meta name="description" content="Explore and download a vast collection of the latest and classic movies in HD. Find your favorite action, comedy, horror, and romantic films easily and for free.">
    <meta name="keywords" content="movie downloader, latest movies, hd movies, download movies, free movies, action movies, comedy, horror, romantic, movie apps">

    <!-- Robots Meta Tag -->
    <meta name="robots" content="index, follow">

    <!-- Canonical URL (‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶ø‡¶§) -->
    <link rel="canonical" href="https://hindimovie.netlify.app/" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hindimovie.netlify.app/">
    <meta property="og:title" content="Movie TV - Watch & Download Latest HD Movies">
    <meta property="og:description" content="Explore and download a vast collection of the latest and classic movies in HD. Find your favorite action, comedy, horror, and romantic films easily and for free.">
    <meta property="og:image" content="https://rabbi50100.github.io/-HD/og-image.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://hindimovie.netlify.app/">
    <meta property="twitter:title" content="Movie TV - Watch & Download Latest HD Movies">
    <meta property="twitter:description" content="Explore and download a vast collection of the latest and classic movies in HD. Find your favorite action, comedy, horror, and romantic films easily and for free.">
    <meta property="twitter:image" content="https://rabbi50100.github.io/-HD/og-image.jpg">

    <!-- ================================================= -->
    <!-- ============== SEO ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶ü‡¶æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó ‡¶∂‡ßá‡¶∑ ============== -->
    <!-- ================================================= -->


    <!-- --- Firebase SDK --- -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <!-- Ad Scripts -->
    <script type='text/javascript' src='//pl27240886.profitableratecpm.com/d0/01/48/d001486b77c50cc7955b8de7fa77722a.js'></script>
    <script type='text/javascript' src='//pl25592823.profitableratecpm.com/5a/44/f3/5a44f3953acebff68b2ef494fac71fea.js'></script>
    
    <!-- JSON-LD Schema for Website -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Movie TV",
      "url": "https://hindimovie.netlify.app/",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://hindimovie.netlify.app/#search={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>

  <style>
    /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ CSS ‡¶ï‡ßã‡¶° ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      overflow-x: hidden;
    }

    body.loading {
        overflow: hidden;
    }

    body.loading > *:not(#loader) {
        display: none;
    }

    /* --- Professional Header Styling --- */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #1a1a1a;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      border-bottom: 2px solid orange;
    }

    header h1 {
      color: orange;
      font-size: 28px;
      font-weight: bold;
      margin: 0;
      letter-spacing: 1px;
      text-shadow: 0 0 5px rgba(255,165,0,0.7);
    }

    /* --- Category Filter Styling --- */
    .category-filters {
      text-align: center;
      margin: 20px 0;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      padding: 0 10px;
    }
    .category-filters button {
      background-color: #333;
      color: orange;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }
    .category-filters button:hover {
      background-color: #555;
    }
    .category-filters button.active {
      background-color: orange;
      color: black;
    }

    /* --- Saved Posts Button Styling --- */
    #saved-posts-button {
      font-size: 16px;
      cursor: pointer;
      color: orange;
      border: 1px solid orange;
      background: none;
      padding: 8px 15px;
      border-radius: 5px;
      transition: background-color 0.3s ease, color 0.3s ease;
      font-weight: bold;
    }

    #saved-posts-button:hover {
      background-color: orange;
      color: #1a1a1a;
    }


    #search-bar {
      margin: 20px auto;
      max-width: 600px;
      display: block;
      width: 100%;
      padding: 10px;
      background-color: #222;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 16px;
    }

    .movie-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      max-width: 600px;
      margin: 20px auto;
    }

    .movie-card {
      background-color: #222;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s;
      position: relative;
    }

    .movie-card:hover {
      transform: scale(1.03);
    }

    .movie-card img {
      width: 100%;
      height: 280px;
      object-fit: cover;
      display: block;
    }

    .movie-title {
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }

    .more-options-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        font-size: 24px;
        cursor: pointer;
        color: orange;
        background: none;
        border: none;
        padding: 2px 8px;
        line-height: 1;
        z-index: 10;
    }

    .options-menu {
        display: none;
        position: absolute;
        top: 35px;
        right: 8px;
        background-color: #333;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.7);
        z-index: 11;
        padding: 5px 0;
        min-width: 120px;
        text-align: left;
    }

    .options-menu a {
        display: block;
        padding: 8px 15px;
        color: white;
        text-decoration: none;
        font-size: 14px;
        transition: background-color 0.2s;
    }

    .options-menu a:hover {
        background-color: #555;
    }

    #savedPostsModal .modal-content {
        background-color: #222;
        text-align: left;
        max-width: 600px;
        padding: 20px;
    }
    #savedPostsModal h2 {
        color: orange;
        text-align: center;
        margin-bottom: 20px;
    }
    #savedPostsModal .thumbnails-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
    }
    #savedPostsModal .thumbnail-item {
        position: relative;
        cursor: pointer;
        border-radius: 5px;
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    #savedPostsModal .thumbnail-item:hover {
        transform: scale(1.05);
        box-shadow: 0 0 15px orange;
    }
    #savedPostsModal .thumbnail-item img {
        width: 100%;
        height: 120px;
        object-fit: cover;
        display: block;
    }
    #savedPostsModal .thumbnail-item .title {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(0,0,0,0.7);
        color: white;
        font-size: 12px;
        padding: 5px;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    #savedPostsModal .remove-saved {
        position: absolute;
        top: 2px;
        right: 2px;
        cursor: pointer;
        color: red;
        font-size: 18px;
        background: rgba(0,0,0,0.5);
        border-radius: 50%;
        width: 22px;
        height: 22px;
        line-height: 22px;
        text-align: center;
        z-index: 10;
    }
    #savedPostsModal .no-posts {
        text-align: center;
        color: #ccc;
        padding: 20px;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.7);
    }

    .modal-content {
      background-color: #222;
      margin: 10% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }

    .modal-content img {
      width: 100%;
      border-radius: 10px;
    }

    .modal-content h3 {
      margin: 15px 0;
      color: orange;
    }

    .modal-content a {
      display: inline-block;
      padding: 10px 20px;
      background-color: orange;
      color: black;
      text-decoration: none;
      font-weight: bold;
      border-radius: 5px;
      margin-top: 10px;
    }

    .modal-content a:hover {
      background-color: darkorange;
    }

    .close {
      float: right;
      font-size: 20px;
      color: white;
      cursor: pointer;
    }

    #loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        flex-direction: column;
    }

    .spinner {
        border: 6px solid #f3f3f3;
        border-top: 6px solid orange;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }
    #loader p {
        color: orange;
        font-size: 18px;
        margin: 0;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .privacy-policy {
      max-width: 800px;
      margin: 40px auto;
      padding: 30px;
      background-color: #222;
      border-radius: 10px;
      color: #fff;
      line-height: 1.6;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }

    .privacy-policy h2, .privacy-policy h3 {
      color: orange;
    }
    /* ...‡¶¨‡¶æ‡¶ï‡¶ø ‡¶∏‡¶¨ CSS ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§... */
    .movie-stats {
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding: 8px 0;
        border-top: 1px solid #333;
        margin-top: 5px;
        font-size: 14px;
    }

    .download-buttons {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
        margin-top: 20px;
    }
    .download-buttons a {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 12px 15px;
        color: white;
        text-decoration: none;
        font-weight: bold;
        border-radius: 8px;
        transition: background-color 0.3s ease;
        font-size: 16px;
        gap: 8px;
    }
    .download-buttons a.watch-button { background-color: #d9534f; }
    .download-buttons a.watch-button:hover { background-color: #c9302c; }
    .download-buttons a.download-button { background-color: #5cb85c; }
    .download-buttons a.download-button:hover { background-color: #4cae4c; }
  </style>
</head>
<body>
  <header>
    <h1>üé¨ Movie TV</h1>
    <button id="saved-posts-button" title="Saved Posts">Saved List</button>
  </header>

  <div class="category-filters">
    <button onclick="filterByCategory('all', event)" class="active">All</button>
    <button onclick="filterByCategory('latest movie', event)">Latest Movie</button>
    <button onclick="filterByCategory('action', event)">Action</button>
    <button onclick="filterByCategory('comedy', event)">Comedy</button>
    <button onclick="filterByCategory('horror', event)">Horror</button>
    <button onclick="filterByCategory('romantic', event)">Romantic</button>
  </div>

  <div id="savedPostsModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('savedPostsModal')">√ó</span>
      <h2>üìö Saved Posts</h2>
      <div class="thumbnails-container" id="saved-posts-list"></div>
      <div class="no-posts" id="no-saved-posts-message" style="display: none;">No saved posts yet.</div>
    </div>
  </div>

  <input type="text" id="search-bar" placeholder="üîç Search movies by title..." onkeyup="filterMovies()">

  <div id="viewerModal" class="modal">
    <div class="modal-content" id="viewerContent"></div>
  </div>

  <div id="loader">
      <div class="spinner"></div>
      <p>Loading Movies...</p>
  </div>

  <div class="movie-grid" id="movie-grid"></div>

  <div id="privacy-policy-section" class="privacy-policy" style="display: none;">
    <!-- ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∏‡¶ø ‡¶™‡¶≤‡¶ø‡¶∏‡¶ø‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá -->
  </div>

  <div class="footer-links">
      <a href="#privacy-policy-section" onclick="showPrivacyPolicy(event)">Privacy Policy</a> | <a href="#">Terms of Service</a>
      <p style="margin-top: 10px;">¬© 2025 Movie TV. All Rights Reserved.</p>
  </div>

<!-- ========================================================== -->
<!-- ============= ‡¶∂‡ßÅ‡¶∞‡ßÅ: ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡ßã‡¶° ============= -->
<!-- ========================================================== -->
<script>
    // --- Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ---
    const firebaseConfig = {
      apiKey: "AIzaSyD-tlrPK8s9h87PVqtvprBy_phcCqONLeU",
      authDomain: "my-movie-81a4b.firebaseapp.com",
      databaseURL: "https://my-movie-81a4b-default-rtdb.firebaseio.com",
      projectId: "my-movie-81a4b",
      storageBucket: "my-movie-81a4b.firebasestorage.app",
      messagingSenderId: "249876555391",
      appId: "1:249876555391:web:81f3ad52805b0aa314c14a",
      measurementId: "G-RHPWTHQHS2"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const moviesRef = database.ref('movies');

    // --- DOM ‡¶â‡¶™‡¶æ‡¶¶‡¶æ‡¶® ---
    const movieGrid = document.getElementById('movie-grid');
    const loader = document.getElementById('loader');
    const mainContent = [document.querySelector('header'), document.querySelector('.category-filters'), document.getElementById('search-bar'), movieGrid];

    // --- ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ ---
    let allMovieData = {}; // ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶Æ‡ßÅ‡¶≠‡¶ø‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ slug ‡¶¶‡¶ø‡ßü‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá
    let allMovieElements = {}; // ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶Æ‡ßÅ‡¶≠‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü
    let currentCategoryFilter = 'all';

    // --- Helper Functions ---
    function createSlug(title) {
        if (!title) return '';
        return title.toLowerCase().replace(/ /g, '-').replace(/[^\w-]+/g, '');
    }

    function escapeQuotes(str) {
        if (typeof str !== 'string') return '';
        return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
    }

    // --- SEO ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶ü‡¶æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ---
    function updateMetaTags(title, description, image, url) {
        const fullTitle = `${title} - Movie TV`;
        document.title = fullTitle;
        document.querySelector('meta[name="title"]').setAttribute('content', fullTitle);
        document.querySelector('meta[name="description"]').setAttribute('content', description);
        document.querySelector('link[rel="canonical"]').setAttribute('href', url);
        
        document.querySelector('meta[property="og:title"]').setAttribute('content', fullTitle);
        document.querySelector('meta[property="og:description"]').setAttribute('content', description);
        document.querySelector('meta[property="og:image"]').setAttribute('content', image);
        document.querySelector('meta[property="og:url"]').setAttribute('content', url);
        
        document.querySelector('meta[property="twitter:title"]').setAttribute('content', fullTitle);
        document.querySelector('meta[property="twitter:description"]').setAttribute('content', description);
        document.querySelector('meta[property="twitter:image"]').setAttribute('content', image);
        document.querySelector('meta[property="twitter:url"]').setAttribute('content', url);
    }
    
    function resetMetaTags() {
        const defaultTitle = "Movie TV - Watch & Download Latest HD Movies";
        const defaultDesc = "Explore and download a vast collection of the latest and classic movies in HD.";
        const defaultImage = "https://rabbi50100.github.io/-HD/og-image.jpg";
        const defaultUrl = window.location.origin;
        updateMetaTags("Movie TV", defaultDesc, defaultImage, defaultUrl);
        document.title = defaultTitle;
    }

    // --- UI ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ---
    function showMainContent(shouldShow) {
        mainContent.forEach(el => {
            if (el) el.style.display = shouldShow ? (el.id === 'movie-grid' ? 'grid' : 'flex') : 'none';
        });
        document.getElementById('search-bar').style.display = shouldShow ? 'block' : 'none';
    }

    // --- ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® ---
    document.addEventListener('DOMContentLoaded', () => {
        document.body.classList.add('loading');
        
        moviesRef.orderByChild('timestamp').once('value', (snapshot) => {
            document.body.classList.remove('loading');
            loader.style.display = 'none';
            movieGrid.innerHTML = '';
            
            const moviesArray = [];
            snapshot.forEach(childSnapshot => {
                const movie = { key: childSnapshot.key, ...childSnapshot.val() };
                movie.slug = createSlug(movie.title);
                moviesArray.push(movie);
                allMovieData[movie.slug] = movie;
            });
            moviesArray.reverse();

            if (moviesArray.length > 0) {
                moviesArray.forEach(addMovieCard);
            } else {
                 movieGrid.innerHTML = '<p style="text-align:center;">No movies found.</p>';
            }

            handleRouteChange();

        }, (error) => {
            document.body.classList.remove('loading');
            loader.style.display = 'none';
            console.error("Error loading movies: ", error);
            movieGrid.innerHTML = '<p style="text-align:center; color:red;">Error loading movies.</p>';
        });
    });

    // --- ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶è‡¶¨‡¶Ç ‡¶≠‡¶ø‡¶â‡ßü‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
    function addMovieCard(movieData) {
      const { key, title, image, link, link2, link3, category, slug, viewCount, likeCount } = movieData;
      const card = document.createElement('div');
      card.className = 'movie-card';
      card.setAttribute('data-key', key);
      card.setAttribute('data-title', title.toLowerCase());
      card.setAttribute('data-category', (category || 'other').toLowerCase());
      card.setAttribute('data-slug', slug);

      card.innerHTML = `
        <button class="more-options-btn" onclick="toggleOptionsMenu(event)">‚Ä¶</button>
        <div class="options-menu" id="options-menu-${key}">
            <a href="#" onclick="savePostToLocalStorage(event, '${key}', '${escapeQuotes(title)}', '${escapeQuotes(image)}', '${escapeQuotes(link)}', '${escapeQuotes(link2)}', '${escapeQuotes(link3)}', '${escapeQuotes(category)}')">Save Post</a>
        </div>
        <div class="movie-content-wrapper" onclick="openViewer('${slug}')">
          <img src="${image}" alt="${title}">
        </div>
        <div class="movie-title">${title}</div>
        <div style="text-align:center; font-size: 14px; color: orange;">[${category || 'Other'}]</div>
        <div class="movie-stats">
          <div class="movie-views"><p>üëÅÔ∏è ${viewCount || 0}</p></div>
          <div class="movie-actions"><button class="like-btn" title="Like Movie" onclick="toggleLike(event, '${key}')">‚ù§Ô∏è <span>${likeCount || 0}</span></button></div>
        </div>
      `;
      movieGrid.appendChild(card);
      allMovieElements[key] = card;
    }

    function openViewer(slug, isDirectLoad = false) {
        const movieData = allMovieData[slug];
        if (!movieData) {
            console.error("Movie not found for slug:", slug);
            window.location.href = '/'; 
            return;
        }

        const { key, title, image, link, link2, link3, category } = movieData;
        const viewerContent = document.getElementById('viewerContent');
        let viewerDownloadButtons = '';
      
        if (link) viewerDownloadButtons += `<a href="${link}" target="_blank" class="watch-button">‚ñ∂Ô∏è Watch Now</a>`;
        if (link2) viewerDownloadButtons += `<a href="${link2}" target="_blank" class="download-button">Download 720p</a>`;
        if (link3) viewerDownloadButtons += `<a href="${link3}" target="_blank" class="download-button">Download 360p</a>`;
      
        viewerContent.innerHTML = `
            <span class="close" onclick="closeModal('viewerModal')">√ó</span>
            <img src="${image}" alt="${title}">
            <h3>${title}</h3>
            <p style="color: #aaa;">Genre: <strong style="color: orange;">${category || 'N/A'}</strong></p>
            <div class="download-buttons">${viewerDownloadButtons}</div>
        `;
        document.getElementById('viewerModal').style.display = 'block';
        showMainContent(false);

        const newUrl = `${window.location.origin}/movie/${slug}`;
        const description = `Watch or download the movie ${title} in HD. Genre: ${category}.`;
        
        if (!isDirectLoad) {
            window.history.pushState({ slug: slug }, title, newUrl);
        }
        updateMetaTags(title, description, image, newUrl);

        const movieRef = database.ref('movies/' + key);
        movieRef.transaction(currentData => {
            if (currentData) {
                currentData.viewCount = (currentData.viewCount || 0) + 1;
            }
            return currentData;
        });
    }

    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
        showMainContent(true);
        
        if (window.location.pathname.startsWith('/movie/')) {
            window.history.pushState({}, '', '/');
        }
        resetMetaTags();
    }

    // --- ‡¶∞‡¶æ‡¶â‡¶ü‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç URL ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç ---
    function handleRouteChange() {
        const path = window.location.pathname;
        if (path.startsWith('/movie/')) {
            const slug = path.substring(7);
            if (allMovieData[slug]) {
                openViewer(slug, true);
            } else {
                console.warn(`Movie with slug "${slug}" not found after data load. Redirecting.`);
                window.history.replaceState({}, '', '/');
                resetMetaTags();
                showMainContent(true);
            }
        } else {
            showMainContent(true);
        }
    }

    window.onpopstate = handleRouteChange;

    // --- ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ---
    function filterMovies() {
      const query = document.getElementById('search-bar').value.toLowerCase();
      Object.values(allMovieElements).forEach(card => {
          const title = card.getAttribute('data-title');
          const category = card.getAttribute('data-category');
          const isCategoryMatch = currentCategoryFilter === 'all' || category.includes(currentCategoryFilter);
          const isSearchMatch = title.includes(query);
          
          card.style.display = isCategoryMatch && isSearchMatch ? 'block' : 'none';
      });
    }

    function filterByCategory(category, event) {
        currentCategoryFilter = category.toLowerCase();
        document.querySelectorAll('.category-filters button').forEach(button => button.classList.remove('active'));
        if (event.target) event.target.classList.add('active');
        filterMovies();
    }

    // --- ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
        closeModal(event.target.id);
      }
      const menus = document.querySelectorAll('.options-menu');
      menus.forEach(menu => {
          if (menu.style.display === 'block' && !menu.contains(event.target) && !event.target.classList.contains('more-options-btn')) {
              menu.style.display = 'none';
          }
      });
    }

    function toggleLike(event, movieKey) {
        event.stopPropagation();
        const storageKey = `likedMovie_${movieKey}`;
        if (localStorage.getItem(storageKey)) {
            alert("You have already liked this movie!");
            return;
        }
        const movieRef = database.ref('movies/' + movieKey);
        movieRef.transaction(currentData => {
            if (currentData) {
                currentData.likeCount = (currentData.likeCount || 0) + 1;
            }
            return currentData;
        }).then(() => {
            localStorage.setItem(storageKey, 'true');
        });
    }

    function toggleOptionsMenu(event) {
        event.stopPropagation();
        const menu = event.target.nextElementSibling;
        const isVisible = menu.style.display === 'block';
        document.querySelectorAll('.options-menu').forEach(m => m.style.display = 'none');
        menu.style.display = isVisible ? 'none' : 'block';
    }

    // --- ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶æ‡¶∞‡¶ø‡¶§‡¶æ ---
    document.getElementById('saved-posts-button').addEventListener('click', () => {
        const savedPostsModal = document.getElementById('savedPostsModal');
        const savedPostsList = document.getElementById('saved-posts-list');
        const noSavedPostsMessage = document.getElementById('no-saved-posts-message');
        savedPostsList.innerHTML = '';
        let hasSavedPosts = false;
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('savedMovie_')) {
                hasSavedPosts = true;
                const movieData = JSON.parse(localStorage.getItem(key));
                const item = document.createElement('div');
                item.className = 'thumbnail-item';
                item.innerHTML = `<img src="${movieData.image}" alt="${movieData.title}"><div class="title">${movieData.title}</div><span class="remove-saved" onclick="removeSavedPost(event, '${key}')">√ó</span>`;
                item.onclick = () => openSavedPostViewer(movieData);
                savedPostsList.appendChild(item);
            }
        }
        noSavedPostsMessage.style.display = hasSavedPosts ? 'none' : 'block';
        savedPostsList.style.display = hasSavedPosts ? 'grid' : 'none';
        savedPostsModal.style.display = 'block';
    });

    function savePostToLocalStorage(event, key, title, image, link, link2, link3, category) {
        event.preventDefault();
        const movieData = { key, title, image, link, link2, link3, category };
        localStorage.setItem(`savedMovie_${key}`, JSON.stringify(movieData));
        alert(`"${title}" has been saved!`);
        event.target.closest('.options-menu').style.display = 'none';
    }
    
    function removeSavedPost(event, key) {
        event.stopPropagation();
        if (confirm('Are you sure you want to remove this post?')) {
            localStorage.removeItem(key);
            event.target.parentElement.remove();
        }
    }

    function openSavedPostViewer(movieData) {
        const slug = createSlug(movieData.title);
        closeModal('savedPostsModal');
        openViewer(slug);
    }

    function showPrivacyPolicy(e) {
      e.preventDefault();
      // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∏‡¶ø ‡¶™‡¶≤‡¶ø‡¶∏‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
      alert("Privacy Policy section is under construction.");
    }
</script>

</body>
    </html>
