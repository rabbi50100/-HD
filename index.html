<!DOCTYPE html>
<html lang="en">
<head>
    <script>(function(d,z,s){s.src='https://'+d+'/401/'+z;try{(document.body||document.documentElement).appendChild(s)}catch(e){}})('groleegni.net',9704632,document.createElement('script'))</script>
    <meta charset="UTF-8">

    <!-- ================= SEO Tags Start ================= -->
    <title>Movie TV - Watch & Download Latest HD Movies</title>
    <meta name="description" content="Watch your favorite new and classic movies and web series. Find a huge collection of films from various genres on our website. Stream online now.">
    <meta name="keywords" content="movies, web series, watch online, stream movies, new movies, movie download, latest films, online cinema">
    <meta name="robots" content="index, follow">
    <!-- Replace with your actual domain -->
    <link rel="canonical" href="https://hindimovie.netlify.app/">

    <!-- Social Media OG Tags (General for the site) -->
    <meta property="og:title" content="Your Movie Website - Watch New Movies & Series">
    <meta property="og:description" content="Discover and stream a vast library of movies and web series online for free.">
    <!-- Replace with a URL to your website's logo or a relevant image -->
    <meta property="og:image" content="https://yourwebsite.com/images/og-image.jpg">
    <meta property="og:url" content="https://hindimovie.netlify.app/">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="en_US">
    <!-- ================= SEO Tags End ================= -->

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff8c00;
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --text-color: #e0e0e0;
            --font-family: 'Roboto', sans-serif;
        }
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            font-size: 16px;
        }

        /* --- Loader --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--background-color); display: flex; justify-content: center;
            align-items: center; z-index: 9999;
        }
        .spinner {
            border: 6px solid #f3f3f330; border-top: 6px solid var(--primary-color);
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Header --- */
        header {
            background-color: var(--surface-color); padding: 15px 20px;
            display: flex; align-items: center; gap: 20px;
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            flex-wrap: wrap;
        }
        .site-title {
            font-size: 1.5rem; font-weight: 700; color: var(--primary-color); margin: 0;
        }
        .search-bar {
            flex-grow: 1; display: flex;
        }
        .search-bar input {
            width: 100%; padding: 10px 15px; border-radius: 20px;
            border: 1px solid #444; background-color: #2a2a2a; color: #fff;
            font-size: 1rem;
        }
        .app-download-btn {
            display: none; padding: 8px 15px; background-color: var(--primary-color);
            color: #111; text-decoration: none; border-radius: 20px;
            font-weight: 700; transition: background-color 0.2s;
        }
        .app-download-btn:hover { background-color: #ffac4d; }

        /* --- Main Content --- */
        main { padding: 20px; }
        #message-bar {
            background-color: #ff8c0022; border: 1px solid var(--primary-color);
            padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;
        }
        #category-filters {
            display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px;
        }
        .filter-btn {
            padding: 8px 18px; border: 1px solid #555; background: none; color: var(--text-color);
            border-radius: 20px; cursor: pointer; white-space: nowrap; transition: all 0.2s;
        }
        .filter-btn.active, .filter-btn:hover {
            background-color: var(--primary-color); color: #111; border-color: var(--primary-color);
        }

        /* --- Movie Grid & Cards --- */
        #movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }
        .movie-card {
            background-color: var(--surface-color); border-radius: 8px; overflow: hidden;
            cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        }
        .movie-card:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.4); }
        .movie-card img {
            width: 100%; display: block; aspect-ratio: 2 / 3; object-fit: cover;
        }
        .movie-card h3 {
            font-size: 1rem; padding: 10px; margin: 0; white-space: nowrap;
            overflow: hidden; text-overflow: ellipsis; text-align: center;
        }

        /* --- Movie Detail Modal --- */
        #movie-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1001; display: none;
            justify-content: center; align-items: center; padding: 20px;
            box-sizing: border-box;
        }
        .modal-content {
            background-color: var(--surface-color); border-radius: 12px;
            max-width: 800px; width: 100%; max-height: 90vh;
            display: flex;
            padding: 20px; overflow-y: auto;
            position: relative;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 0;
        }
        
        .modal-close {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 38px;
            height: 38px;
            background-color: #f5c518;
            color: #111;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: 700;
            line-height: 1;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 2px solid var(--surface-color);
        }
        
        #modal-top-banner-container {
            width: 100%;
            max-width: 320px;
            min-height: 50px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-poster img {
            max-width: 280px;
            width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .modal-title-custom {
            color: #f5c518;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .modal-links-custom {
            display: flex;
            flex-direction: column;
            width: 90%;
            max-width: 400px;
            gap: 12px;
            margin-bottom: 25px;
        }
        .modal-link-btn {
            padding: 12px 20px;
            color: #ffffff;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 700;
            text-align: center;
            font-size: 1.1rem;
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        .modal-link-btn.watch-now { background-color: #d90429; }
        .modal-link-btn.watch-360p { background-color: #2b9348; }
        .modal-link-btn.watch-720p { background-color: #0077b6; }

        .info-table {
            width: 90%;
            max-width: 400px;
            margin-bottom: 25px;
            padding: 10px 0;
        }
        .info-row {
            display: flex;
            justify-content: flex-start;
            padding: 8px 5px;
            text-align: left;
            border-bottom: 1px solid #2a2a2a;
        }
        .info-row:last-child { border-bottom: none; }
        .info-label {
            color: #f5c518;
            font-weight: 500;
            width: 120px;
            flex-shrink: 0;
        }
        
        #modal-ad-banner-container {
            width: 90%;
            max-width: 400px;
            margin-bottom: 20px;
            min-height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .description-section {
            width: 90%;
            max-width: 400px;
            text-align: left;
        }
        .description-title {
            color: #e0e0e0;
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        #modal-description {
            line-height: 1.6;
            color: #ccc;
            font-size: 0.95rem;
            text-align: justify;
        }

        @media (max-width: 600px) {
            header { flex-direction: column; }
            .modal-poster img { max-width: 220px; }
            .modal-close { top: 5px; right: 5px; width: 34px; height: 34px; }
        }
    </style>
</head>
<body>
    <script type='text/javascript' src='//pl27426947.profitableratecpm.com/d3/fe/7a/d3fe7aca9abd2f57e8dfcc0ce1fcc180.js'></script>

    <div id="loader"><div class="spinner"></div></div>

    <header>
        <h1 class="site-title">Movie TV</h1>
        <div class="search-bar">
            <input type="search" id="search-input" placeholder="Search for a movie...">
        </div>
        <a href="#" id="app-download-btn" class="app-download-btn" target="_blank">Download App</a>
    </header>

    <main>
        <div id="message-bar" style="display: none;"></div>
        <div id="category-filters"></div>
        <div id="movie-grid"></div>
    </main>

    <div id="movie-modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            
            <div id="modal-top-banner-container">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '4fd4f9b283da8f12b3162d7d1cb23317',
                        'format' : 'iframe',
                        'height' : 50,
                        'width' : 320,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/4fd4f9b283da8f12b3162d7d1cb23317/invoke.js"></script>
            </div>

            <div class="modal-poster">
                <img id="modal-img" src="" alt="Movie Poster">
            </div>

            <h2 id="modal-title" class="modal-title-custom"></h2>

            <div id="modal-links" class="modal-links-custom"></div>

            <div class="info-table">
                <div class="info-row">
                    <span class="info-label">Director</span>
                    <span id="modal-director"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Genre</span>
                    <span id="modal-category"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Cast</span>
                    <span id="modal-cast"></span>
                </div>
                 <div class="info-row">
                    <span class="info-label">Release Date</span>
                    <span id="modal-release-date"></span>
                </div>
            </div>
            
            <div id="modal-ad-banner-container">
                <script type="text/javascript">
                    atOptions = {
                        'key' : 'ca89ce47317b6a13d35e3c7e04813e6a',
                        'format' : 'iframe',
                        'height' : 250,
                        'width' : 300,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/ca89ce47317b6a13d35e3c7e04813e6a/invoke.js"></script>
            </div>

            <div class="description-section">
                <h3 class="description-title">DESCRIPTION</h3>
                <p id="modal-description"></p>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyD-tlrPK8s9h87PVqtvprBy_phcCqONLeU",
            authDomain: "my-movie-81a4b.firebaseapp.com",
            databaseURL: "https://my-movie-81a4b-default-rtdb.firebaseio.com",
            projectId: "my-movie-81a4b",
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const moviesRef = database.ref('movies');
        const settingsRef = database.ref('siteSettings');
        const analyticsRef = database.ref('analytics/visits');

        // --- DOM Elements ---
        const loader = document.getElementById('loader');
        const movieGrid = document.getElementById('movie-grid');
        const categoryFilters = document.getElementById('category-filters');
        const searchInput = document.getElementById('search-input');
        const modal = document.getElementById('movie-modal');

        let allMovies = [];

        // Function to convert a movie title into a URL-friendly "slug"
        function createSlug(title) {
            return title
                .toLowerCase()
                .replace(/[^\w\s-]/g, '') // Remove non-word chars
                .replace(/[\s_-]+/g, '-')  // Replace spaces with -
                .replace(/^-+|-+$/g, '');   // Remove leading/trailing dashes
        }

        document.addEventListener('DOMContentLoaded', () => {
            logVisit();
            loadSiteSettings();
            loadMovies();
        });
        
        function logVisit() {
            analyticsRef.push({
                timestamp: Date.now(),
                referrer: document.referrer
            }).catch(error => console.error("Analytics error:", error));
        }

        function loadSiteSettings() {
            settingsRef.once('value', snapshot => {
                const settings = snapshot.val();
                if (!settings) return;

                const appBtn = document.getElementById('app-download-btn');
                if (settings.appDownloadUrl) {
                    appBtn.href = settings.appDownloadUrl;
                    appBtn.style.display = 'inline-block';
                }
            });
        }
        
        function loadMovies() {
            loader.style.display = 'flex';
            moviesRef.orderByChild('timestamp').once('value', snapshot => {
                const moviesData = snapshot.val();
                if (moviesData) {
                    allMovies = Object.entries(moviesData).map(([key, value]) => ({ 
                        key, 
                        ...value,
                        slug: createSlug(value.title) 
                    })).reverse();
                    
                    const initialMovies = allMovies.filter(movie => movie.category !== 'upcoming');
                    displayMovies(initialMovies);
                    populateCategories();

                    // Check the URL path to open a movie on page load
                    handleUrlPath();
                }
                loader.style.display = 'none';
            });
        }

        // This function reads the URL path and opens the corresponding movie modal
        function handleUrlPath() {
            const path = window.location.pathname;
            if (path.startsWith('/movie/')) {
                const slug = path.split('/movie/')[1];
                if (slug) {
                    const movieToOpen = allMovies.find(movie => movie.slug === slug);
                    if (movieToOpen) {
                        openModal(movieToOpen, true); // Open without pushing a new history state
                    }
                }
            }
        }

        function displayMovies(movies) {
            movieGrid.innerHTML = '';
            if (movies.length === 0) {
                movieGrid.innerHTML = '<p>No movies found.</p>';
                return;
            }
            movies.forEach(movie => {
                const card = document.createElement('div');
                card.className = 'movie-card';
                card.innerHTML = `<img src="${movie.image}" alt="${movie.title} Poster" loading="lazy"><h3>${movie.title}</h3>`;
                card.onclick = () => openModal(movie);
                movieGrid.appendChild(card);
            });
        }

        function populateCategories() {
            const categories = ['All', ...new Set(allMovies.map(m => m.category))];
            categoryFilters.innerHTML = '';
            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.textContent = category;
                if (category === 'All') {
                    btn.classList.add('active');
                }
                btn.onclick = () => filterByCategory(category, btn);
                categoryFilters.appendChild(btn);
            });
        }

        function filterByCategory(category, clickedBtn) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            clickedBtn.classList.add('active');
            
            let filteredMovies;
            if (category === 'All') {
                filteredMovies = allMovies.filter(movie => movie.category !== 'upcoming');
            } else {
                filteredMovies = allMovies.filter(movie => movie.category === category);
            }
            
            displayMovies(filteredMovies);
        }
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredMovies = allMovies.filter(movie => 
                movie.title.toLowerCase().includes(searchTerm)
            );
            displayMovies(filteredMovies);
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            if (document.querySelector('.filter-btn')) {
                document.querySelector('.filter-btn').classList.add('active');
            }
        });

        // The openModal function now uses the History API to change the URL
        function openModal(movie, fromUrl = false) {
            const newUrl = `/movie/${movie.slug}`;
            
            // Only change the URL if the modal wasn't opened by the URL itself
            if (!fromUrl) {
                history.pushState({ movieId: movie.key }, movie.title, newUrl);
            }

            // Populate the modal content
            document.title = `${movie.title} - Your Movie Website`;
            const releaseYear = movie.releaseDate ? ` (${movie.releaseDate.substring(0, 4)})` : '';
            document.getElementById('modal-title').textContent = movie.title + releaseYear;
            document.getElementById('modal-img').src = movie.image;
            document.getElementById('modal-img').alt = movie.title;
            document.getElementById('modal-category').textContent = movie.category || 'N/A';
            document.getElementById('modal-description').innerHTML = movie.description || 'No description available.';
            document.getElementById('modal-director').textContent = movie.director || 'N/A';
            document.getElementById('modal-cast').textContent = movie.cast || 'N/A';
            document.getElementById('modal-release-date').textContent = movie.releaseDate || 'N/A';

            const linksContainer = document.getElementById('modal-links');
            linksContainer.innerHTML = '';
            if (movie.link) {
                linksContainer.innerHTML += `<a href="${movie.link}" class="modal-link-btn watch-now" target="_blank">▶ Watch Now</a>`;
            }
            if (movie.link3) {
                linksContainer.innerHTML += `<a href="${movie.link3}" class="modal-link-btn watch-360p" target="_blank">Watch 360p</a>`;
            }
            if (movie.link2) {
                linksContainer.innerHTML += `<a href="${movie.link2}" class="modal-link-btn watch-720p" target="_blank">Watch 720p</a>`;
            }
            
            modal.style.display = 'flex';
        }

        // The closeModal function now updates the URL back to the homepage
        function closeModal() {
            history.pushState(null, 'Your Movie Website', '/'); // Go back to the root URL
            document.title = 'Your Movie Website - Watch New Movies & Series';
            modal.style.display = 'none';
        }
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Handle browser back/forward button clicks
        window.onpopstate = function(event) {
            // Check if the state contains our movie data
            if (event.state && event.state.movieId) {
                const movieToOpen = allMovies.find(m => m.key === event.state.movieId);
                if (movieToOpen) {
                    openModal(movieToOpen, true); // Open modal without changing history again
                }
            } else {
                // If no state, it means we are at the homepage URL
                closeModal();
            }
        };
    </script>
</body>
    </html>
